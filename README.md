# æ¨¡å—åŒ–å¼€å‘ä¸è§„èŒƒåŒ–æ ‡å‡†

## ä¸€ã€ç®€å•é¢˜
### 1ã€Webpack çš„æ„å»ºæµç¨‹ä¸»è¦æœ‰å“ªäº›ç¯èŠ‚ï¼Ÿå¦‚æœå¯ä»¥è¯·å°½å¯èƒ½è¯¦å°½çš„æè¿° Webpack æ‰“åŒ…çš„æ•´ä¸ªè¿‡ç¨‹ã€‚
#### 1. æ„å»ºæµç¨‹
  - æ ¹æ®é…ç½®æ–‡ä»¶ï¼Œè¯†åˆ«å…¥å£æ–‡ä»¶
  - è¯†åˆ«æ¨¡å—ä¾èµ–ï¼Œå¦‚`CommonJS`ã€`AMD`å’Œ`ESM`ç­‰
  - è¯†åˆ«ä»£ç ï¼Œå¹¶é€šè¿‡Loaderã€Pluginså’Œminimizerå¯¹ä»£ç è¿›è¡Œå¤„ç†
  - è¾“å‡ºä»£ç åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
#### 2. è¯¦ç»†æè¿°
  - è§£æé…ç½®å‚æ•°ï¼Œæ˜¯åˆå¹¶å‘½ä»¤è¡Œä¼ å…¥å’Œé…ç½®æ–‡ä»¶(å¦‚webpack.config.js)çš„æ‰€æœ‰å‚æ•°ã€‚
  - é€šè¿‡åˆå¹¶åçš„å‚æ•°åˆå§‹åŒ–`compiler`å¯¹è±¡ï¼Œæ³¨å†Œæ‰€æœ‰é…ç½®æ’ä»¶ï¼Œæ’ä»¶å¯ä»¥ç›‘å¬ç”Ÿå‘½å‘¨æœŸçš„é’©å­èŠ‚ç‚¹äº‹ä»¶ï¼Œå¹¶åœ¨å¯¹åº”èŠ‚ç‚¹æ‰§è¡Œå¯¹è±¡ä¸­çš„runæ–¹æ³•æ‰§è¡Œç¼–è¯‘ã€‚
  - è¯»å–é…ç½®ä¸­çš„`entry`å±æ€§è·å–æ‰“åŒ…å…¥å£ï¼Œè§£ææ–‡ä»¶æ„å»ºè¯­æ³•æ ‘ï¼Œæ‰¾å‡ºä¾èµ–å¹¶ä¸”å‘ä¸‹é€’å½’
  - é€’å½’æ‰€æœ‰çš„ä¾èµ–å…³ç³»æ–‡ä»¶å¹¶æ ¹æ®æ–‡ä»¶ç±»å‹å’ŒLoaderé…ç½®å¯¹æ–‡ä»¶è¿›è¡Œè½¬æ¢ã€‚
  - é€’å½’å®Œæˆåï¼Œå¾—åˆ°æ‰€æœ‰çš„å¤„ç†åçš„ä»£ç å—
  - æ ¹æ®`output`é…ç½®è¾“å‡ºä»£ç å—åˆ°æŒ‡å®šæ–‡ä»¶

### 2ã€Loader å’Œ Plugin æœ‰å“ªäº›ä¸åŒï¼Ÿè¯·æè¿°ä¸€ä¸‹å¼€å‘ Loader å’Œ Plugin çš„æ€è·¯ã€‚
#### 1. ä¸åŒç‚¹
  - Loader ä¸“æ³¨å®ç°èµ„æºæ¨¡å—åŠ è½½ï¼Œå¦‚`js`ã€`css`ã€`å›¾ç‰‡`ç­‰èµ„æº
  - Plugin è§£å†³å…¶ä»–è‡ªåŠ¨åŒ–é—®é¢˜ï¼Œå¦‚æ¸…é™¤distç›®å½•ã€æ‹·è´ä¸éœ€è¦æ‰“åŒ…çš„é™æ€èµ„æºåˆ°è¾“å‡ºç›®å½•ã€å‹ç¼©è¾“å‡ºä»£ç ç­‰

#### 2. å¼€å‘æ€è·¯
  - Loaderï¼š
    - Loader æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè´Ÿè´£èµ„æºæ–‡ä»¶ä»è¾“å…¥åˆ°è¾“å‡ºçš„è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–‡ä»¶è¾“å…¥å‚æ•°`source`è·å–æ–‡ä»¶å†…å®¹å¹¶è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚
    - å¯¹äºåŒä¸€ä¸ªèµ„æºå¯ä»¥ä¾æ¬¡ä½¿ç”¨å¤šä¸ªLoaderï¼Œä»¥ç®¡é“çš„æ–¹å¼è¿è¡Œï¼Œæœ€ç»ˆéœ€è¦è¿”å›ä¸€æ®µjsä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬å¼€å‘çš„Loaderå¯ä»¥è¿”å›ä¸€æ®µå¯¼å‡ºçš„JSä»£ç ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€æ®µå­—ç¬¦ä¸²äº¤ç»™ä¸‹ä¸€ä¸ªLoaderç»§ç»­å¤„ç†ã€‚
    - ä»¥ä¸€ä¸ª`markdown`è½¬æ¢loaderä¸ºä¾‹
      ```js
      // ç¬¬ä¸€ç§ï¼Œæ‰‹åŠ¨è½¬æ¢ä¸ºJSä»£ç 
      const marked = require('marked')

      module.exports = source => {
        // sourceä¸ºmdæ–‡ä»¶å†…å®¹
        const html = marked(source)

        return `module.exports = ${JSON.stringify(html)}`
      }

      // ç¬¬äºŒç§ï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªhtml-loaderç»§ç»­å¤„ç†
      const marked = require('marked')

      module.exports = source => {
        const html = marked(source)
      
        // è¿”å›htmlå­—ç¬¦ä¸²äº¤ç»™ä¸‹ä¸€ä¸ªloaderå¤„ç†
        return html
      }
      ```
  
  - Pluginï¼š
    - é€šè¿‡åœ¨ç”Ÿå‘½å‘¨æœŸçš„**é’©å­**ä¸­æŒ‚è½½å‡½æ•°æ¥å®ç°æ‰©å±•
    - å¿…é¡»æ˜¯ä¸€ä¸ª**å‡½æ•°**æˆ–æ˜¯ä¸€ä¸ªåŒ…å«**applyæ–¹æ³•**çš„å¯¹è±¡
    - å‡½æ•°å†…éƒ¨çš„ä¸»è¦æµç¨‹å°±æ˜¯æŒ‚è½½åˆ°å¯¹åº”é’©å­->è·å–æ–‡ä»¶å†…å®¹->ä¿®æ”¹æ–‡ä»¶è¾“å‡º
    - å®Œæˆç§»é™¤bundle.jsæ³¨é‡Šæ’ä»¶
      ```js
      class MyPlugin {
        apply (compiler) {
          console.log('MyPlugin å¯åŠ¨')
          // æŒ‚è½½åˆ°emité’©å­ä¸Š
          compiler.hooks.emit.tap('MyPlugin', compilation => {
            // compilation => å¯ä»¥ç†è§£ä¸ºæ­¤æ¬¡æ‰“åŒ…çš„ä¸Šä¸‹æ–‡
            for(const name in compilation.assets) {
              if(name.endsWith('.js')) {
                // è·å–æ–‡ä»¶å†…å®¹
                const contents = compilation.assets[name].source()
                const withoutCommonts = contents.replace(/\/\*\*+\*\//g, '')
                // ä¿®æ”¹æ–‡ä»¶è¾“å‡º
                compilation.assets[name] = {
                  source: () => withoutCommonts,
                  size: () => withoutCommonts.length
                }
              }
            }
          })
        }
      }
      ```

## äºŒã€ç¼–ç¨‹é¢˜
### 1ã€ä½¿ç”¨ Webpack å®ç° Vue é¡¹ç›®æ‰“åŒ…ä»»åŠ¡
- ä»£ç å·²æ”¾ç½®åœ¨`code`ç›®å½•ä¸‹
- [è§†é¢‘ç®€ä»‹](https://v.youku.com/v_show/id_XNDc3OTIxOTU5Mg==.html?x=&sharefrom=android&sharekey=8be9dea2392aca6fc08022babd6520a01)
- ç”±äºç”µè„‘éº¦å…‹é£é—®é¢˜ï¼Œè§†é¢‘è¢«è¿«é‡‡ç”¨æ‰‹æœºå½•åˆ¶ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹æ™ƒï¼Œéº»çƒ¦è€å¸ˆäº†ğŸ¤¦â€â™‚ï¸